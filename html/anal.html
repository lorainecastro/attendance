<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics & Prediction Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .filters {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .filter-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .risk-overview {
            grid-column: 1 / -1;
        }

        .risk-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .risk-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .risk-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .risk-card h4 {
            font-size: 0.9rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .risk-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .risk-card .subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .risk-level {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .risk-low {
            background: #d4edda;
            color: #155724;
        }

        .risk-medium {
            background: #fff3cd;
            color: #856404;
        }

        .risk-high {
            background: #f8d7da;
            color: #721c24;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .recommendations {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .recommendations h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .recommendation-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .recommendation-item:hover {
            transform: translateX(5px);
        }

        .recommendation-item .priority {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }

        .priority-high {
            background: #ff6b6b;
            color: white;
        }

        .priority-medium {
            background: #feca57;
            color: white;
        }

        .priority-low {
            background: #48dbfb;
            color: white;
        }

        .prediction-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .prediction-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .prediction-item .label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .prediction-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .attendance-heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-top: 20px;
        }

        .heatmap-day {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: white;
            font-weight: bold;
        }

        .present { background: #28a745; }
        .absent { background: #dc3545; }
        .late { background: #ffc107; color: #212529; }
        .weekend { background: #e9ecef; color: #6c757d; }

        .factors-analysis {
            margin-top: 20px;
        }

        .factor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .factor-bar {
            height: 6px;
            background: #667eea;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .factor-impact {
            width: 100px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .prediction-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Analytics & Prediction Dashboard</h1>
            <p>Time Series Forecasting and Regression Analysis for Student Attendance Monitoring</p>
        </div>

        <div class="filters">
            <div class="filter-group">
                <label>School Year</label>
                <select id="schoolYear">
                    <option value="2024-2025">2024-2025</option>
                    <option value="2023-2024">2023-2024</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Grade Level</label>
                <select id="gradeLevel">
                    <option value="all">All Grades</option>
                    <option value="grade7">Grade 7</option>
                    <option value="grade8">Grade 8</option>
                    <option value="grade9">Grade 9</option>
                    <option value="grade10">Grade 10</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Section</label>
                <select id="section">
                    <option value="all">All Sections</option>
                    <option value="section-a">Section A</option>
                    <option value="section-b">Section B</option>
                    <option value="section-c">Section C</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Student</label>
                <select id="studentSelect">
                    <option value="">Select Student</option>
                    <option value="student1">Maria Santos</option>
                    <option value="student2">Juan Dela Cruz</option>
                    <option value="student3">Ana Garcia</option>
                    <option value="student4">Pedro Reyes</option>
                </select>
            </div>
        </div>

        <div class="card risk-overview">
            <h3>🎯 Student Risk Assessment & Predictions</h3>
            <div class="risk-cards">
                <div class="risk-card">
                    <h4>Continuation Probability</h4>
                    <div class="value" id="continuationProb">78%</div>
                    <div class="subtitle">Likelihood to continue attending</div>
                </div>
                <div class="risk-card">
                    <h4>Attendance Forecast</h4>
                    <div class="value" id="attendanceForecast">82%</div>
                    <div class="subtitle">Predicted rate (next 30 days)</div>
                </div>
                <div class="risk-card">
                    <h4>Risk Level</h4>
                    <div class="value">
                        <span class="risk-level risk-medium" id="riskLevel">MEDIUM</span>
                    </div>
                    <div class="subtitle">Early intervention needed</div>
                </div>
                <div class="risk-card">
                    <h4>Intervention Priority</h4>
                    <div class="value" id="interventionPriority">3/5</div>
                    <div class="subtitle">Immediate attention required</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>📈 Attendance Time Series Forecast</h3>
                <div class="chart-container">
                    <canvas id="attendanceChart"></canvas>
                </div>
                <div class="prediction-details">
                    <div class="prediction-item">
                        <div class="label">Next Week Prediction</div>
                        <div class="value">85%</div>
                    </div>
                    <div class="prediction-item">
                        <div class="label">Trend Direction</div>
                        <div class="value">↗️ Improving</div>
                    </div>
                    <div class="prediction-item">
                        <div class="label">Confidence Level</div>
                        <div class="value">73%</div>
                    </div>
                    <div class="prediction-item">
                        <div class="label">Seasonal Pattern</div>
                        <div class="value">Detected</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>🎯 Regression Analysis Results</h3>
                <div class="chart-container">
                    <canvas id="regressionChart"></canvas>
                </div>
                <div class="factors-analysis">
                    <h4>Key Factors Affecting Attendance:</h4>
                    <div class="factor-item">
                        <span>Geographic Distance</span>
                        <div class="factor-impact">
                            <div class="factor-bar" style="width: 85%"></div>
                        </div>
                        <span>85%</span>
                    </div>
                    <div class="factor-item">
                        <span>Family Income</span>
                        <div class="factor-impact">
                            <div class="factor-bar" style="width: 70%"></div>
                        </div>
                        <span>70%</span>
                    </div>
                    <div class="factor-item">
                        <span>Previous Attendance</span>
                        <div class="factor-impact">
                            <div class="factor-bar" style="width: 90%"></div>
                        </div>
                        <span>90%</span>
                    </div>
                    <div class="factor-item">
                        <span>Health Issues</span>
                        <div class="factor-impact">
                            <div class="factor-bar" style="width: 45%"></div>
                        </div>
                        <span>45%</span>
                    </div>
                    <div class="factor-item">
                        <span>Family Structure</span>
                        <div class="factor-impact">
                            <div class="factor-bar" style="width: 60%"></div>
                        </div>
                        <span>60%</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>🗓️ Attendance Pattern Analysis</h3>
                <div class="attendance-heatmap" id="attendanceHeatmap">
                    <!-- Heatmap will be generated by JavaScript -->
                </div>
                <div style="margin-top: 15px;">
                    <span style="margin-right: 15px;">🟢 Present</span>
                    <span style="margin-right: 15px;">🔴 Absent</span>
                    <span style="margin-right: 15px;">🟡 Late</span>
                    <span>⚪ Weekend</span>
                </div>
            </div>

            <div class="card">
                <h3>📊 Absence Reason Analysis</h3>
                <div class="chart-container">
                    <canvas id="absenceChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>🤖 AI-Generated Recommendations</h3>
            <div class="recommendations">
                <h4>Immediate Actions Required:</h4>
                <div class="recommendation-item">
                    <span class="priority priority-high">HIGH</span>
                    Contact family immediately - Student has 3 consecutive absences
                </div>
                <div class="recommendation-item">
                    <span class="priority priority-medium">MEDIUM</span>
                    Schedule health check referral due to frequent health-related absences
                </div>
                <div class="recommendation-item">
                    <span class="priority priority-high">HIGH</span>
                    Arrange transportation assistance - Distance identified as major factor
                </div>
                
                <h4>Long-term Interventions:</h4>
                <div class="recommendation-item">
                    <span class="priority priority-medium">MEDIUM</span>
                    Enroll in peer mentorship program to improve engagement
                </div>
                <div class="recommendation-item">
                    <span class="priority priority-low">LOW</span>
                    Include in family engagement initiative next month
                </div>
                <div class="recommendation-item">
                    <span class="priority priority-medium">MEDIUM</span>
                    Recommend for academic support program based on attendance pattern
                </div>
            </div>
        </div>

        <div class="export-buttons">
            <button class="btn btn-primary" onclick="exportReport('individual')">
                📄 Export Individual Report
            </button>
            <button class="btn btn-primary" onclick="exportReport('class')">
                📊 Export Class Summary
            </button>
            <button class="btn btn-primary" onclick="exportReport('predictions')">
                🔮 Export Predictions
            </button>
            <button class="btn btn-secondary" onclick="printDashboard()">
                🖨️ Print Dashboard
            </button>
        </div>
    </div>

    <script>
        // Sample data - in real implementation, this would come from your database
        const attendanceData = {
            student1: {
                name: "Maria Santos",
                continuationProb: 78,
                attendanceForecast: 82,
                riskLevel: "MEDIUM",
                interventionPriority: "3/5"
            },
            student2: {
                name: "Juan Dela Cruz",
                continuationProb: 92,
                attendanceForecast: 88,
                riskLevel: "LOW",
                interventionPriority: "1/5"
            },
            student3: {
                name: "Ana Garcia",
                continuationProb: 45,
                attendanceForecast: 55,
                riskLevel: "HIGH",
                interventionPriority: "5/5"
            },
            student4: {
                name: "Pedro Reyes",
                continuationProb: 67,
                attendanceForecast: 75,
                riskLevel: "MEDIUM",
                interventionPriority: "2/5"
            }
        };

        // Initialize charts
        let attendanceChart, regressionChart, absenceChart;

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            generateHeatmap();
            
            // Add event listeners for filters
            document.getElementById('studentSelect').addEventListener('change', updateStudentData);
            document.getElementById('gradeLevel').addEventListener('change', updateDashboard);
            document.getElementById('section').addEventListener('change', updateDashboard);
        });

        function initializeCharts() {
            // Attendance Time Series Chart
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                    datasets: [{
                        label: 'Actual Attendance',
                        data: [85, 78, 82, 75, 88, 80, 85, 82],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Predicted Attendance',
                        data: [null, null, null, null, null, null, 82, 85, 88, 90],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Attendance Trend & Forecast'
                        }
                    }
                }
            });

            // Regression Analysis Chart
            const regressionCtx = document.getElementById('regressionChart').getContext('2d');
            regressionChart = new Chart(regressionCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Attendance vs Distance',
                        data: [
                            {x: 1, y: 95},
                            {x: 2, y: 88},
                            {x: 3, y: 82},
                            {x: 4, y: 78},
                            {x: 5, y: 70},
                            {x: 6, y: 65},
                            {x: 7, y: 58},
                            {x: 8, y: 52}
                        ],
                        backgroundColor: '#667eea',
                        borderColor: '#667eea'
                    }, {
                        label: 'Regression Line',
                        data: [
                            {x: 1, y: 92},
                            {x: 8, y: 55}
                        ],
                        type: 'line',
                        borderColor: '#ff6b6b',
                        backgroundColor: 'transparent',
                        borderWidth: 2,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Distance from School (km)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Attendance Rate (%)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distance vs Attendance Correlation'
                        }
                    }
                }
            });

            // Absence Reasons Chart
            const absenceCtx = document.getElementById('absenceChart').getContext('2d');
            absenceChart = new Chart(absenceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Illness', 'Family Issues', 'Transportation', 'Personal', 'Other'],
                    datasets: [{
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#f5576c',
                            '#4facfe'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Absence Reasons Distribution'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function generateHeatmap() {
            const heatmapContainer = document.getElementById('attendanceHeatmap');
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            // Sample attendance data for a month
            const attendancePattern = [
                'present', 'present', 'late', 'present', 'present', 'weekend', 'weekend',
                'present', 'absent', 'absent', 'present', 'present', 'weekend', 'weekend',
                'late', 'present', 'present', 'present', 'late', 'weekend', 'weekend',
                'present', 'present', 'present', 'present', 'present', 'weekend', 'weekend',
                'present', 'present', 'late', 'present', 'present', 'weekend', 'weekend'
            ];

            // Create header row
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'heatmap-day';
                dayHeader.style.background = '#6c757d';
                dayHeader.textContent = day;
                heatmapContainer.appendChild(dayHeader);
            });

            // Create attendance grid
            attendancePattern.forEach((status, index) => {
                const dayCell = document.createElement('div');
                dayCell.className = `heatmap-day ${status}`;
                dayCell.textContent = Math.floor(index / 7) + 1;
                dayCell.title = `Day ${index + 1}: ${status}`;
                heatmapContainer.appendChild(dayCell);
            });
        }

        function updateStudentData() {
            const selectedStudent = document.getElementById('studentSelect').value;
            if (!selectedStudent || !attendanceData[selectedStudent]) return;

            const data = attendanceData[selectedStudent];
            
            // Update risk cards
            document.getElementById('continuationProb').textContent = data.continuationProb + '%';
            document.getElementById('attendanceForecast').textContent = data.attendanceForecast + '%';
            document.getElementById('interventionPriority').textContent = data.interventionPriority;
            
            // Update risk level
            const riskElement = document.getElementById('riskLevel');
            riskElement.textContent = data.riskLevel;
            riskElement.className = `risk-level risk-${data.riskLevel.toLowerCase()}`;

            // Update charts with new data (in real implementation, fetch from API)
            updateCharts(selectedStudent);
        }

        function updateCharts(studentId) {
            // Update attendance chart based on selected student
            const newAttendanceData = getStudentAttendanceData(studentId);
            attendanceChart.data.datasets[0].data = newAttendanceData.actual;
            attendanceChart.data.datasets[1].data = newAttendanceData.predicted;
            attendanceChart.update();
            
            // Update regression chart
            const newRegressionData = getStudentRegressionData(studentId);
            regressionChart.data.datasets[0].data = newRegressionData;
            regressionChart.update();
            
            // Update absence chart
            const newAbsenceData = getStudentAbsenceData(studentId);
            absenceChart.data.datasets[0].data = newAbsenceData;
            absenceChart.update();
        }

        function getStudentAttendanceData(studentId) {
            // Mock data - replace with actual API call
            const attendancePatterns = {
                student1: {
                    actual: [85, 78, 82, 75, 88, 80, 85, 82],
                    predicted: [null, null, null, null, null, null, 82, 85, 88, 90]
                },
                student2: {
                    actual: [92, 88, 90, 85, 94, 89, 91, 88],
                    predicted: [null, null, null, null, null, null, 88, 90, 92, 94]
                },
                student3: {
                    actual: [65, 58, 62, 45, 68, 55, 60, 52],
                    predicted: [null, null, null, null, null, null, 52, 55, 58, 60]
                },
                student4: {
                    actual: [78, 72, 75, 68, 82, 70, 77, 74],
                    predicted: [null, null, null, null, null, null, 74, 77, 80, 82]
                }
            };
            return attendancePatterns[studentId] || attendancePatterns.student1;
        }

        function getStudentRegressionData(studentId) {
            // Mock regression data for different students
            const regressionPatterns = {
                student1: [
                    {x: 1, y: 95}, {x: 2, y: 88}, {x: 3, y: 82}, {x: 4, y: 78},
                    {x: 5, y: 70}, {x: 6, y: 65}, {x: 7, y: 58}, {x: 8, y: 52}
                ],
                student2: [
                    {x: 1, y: 98}, {x: 2, y: 95}, {x: 3, y: 92}, {x: 4, y: 88},
                    {x: 5, y: 85}, {x: 6, y: 82}, {x: 7, y: 78}, {x: 8, y: 75}
                ],
                student3: [
                    {x: 1, y: 75}, {x: 2, y: 68}, {x: 3, y: 62}, {x: 4, y: 55},
                    {x: 5, y: 48}, {x: 6, y: 42}, {x: 7, y: 35}, {x: 8, y: 28}
                ],
                student4: [
                    {x: 1, y: 88}, {x: 2, y: 82}, {x: 3, y: 75}, {x: 4, y: 70},
                    {x: 5, y: 65}, {x: 6, y: 58}, {x: 7, y: 52}, {x: 8, y: 45}
                ]
            };
            return regressionPatterns[studentId] || regressionPatterns.student1;
        }

        function getStudentAbsenceData(studentId) {
            // Mock absence reason data for different students
            const absencePatterns = {
                student1: [35, 25, 20, 15, 5],
                student2: [15, 10, 45, 25, 5],
                student3: [45, 35, 10, 8, 2],
                student4: [25, 30, 25, 15, 5]
            };
            return absencePatterns[studentId] || absencePatterns.student1;
        }

        function updateDashboard() {
            // Update dashboard based on grade level and section filters
            const gradeLevel = document.getElementById('gradeLevel').value;
            const section = document.getElementById('section').value;
            
            // In real implementation, this would fetch filtered data from API
            console.log('Updating dashboard for:', gradeLevel, section);
            
            // Update student dropdown based on filters
            updateStudentDropdown(gradeLevel, section);
        }

        function updateStudentDropdown(gradeLevel, section) {
            const studentSelect = document.getElementById('studentSelect');
            const students = {
                'grade7': {
                    'section-a': [
                        {value: 'student1', text: 'Maria Santos'},
                        {value: 'student2', text: 'Juan Dela Cruz'}
                    ],
                    'section-b': [
                        {value: 'student3', text: 'Ana Garcia'},
                        {value: 'student4', text: 'Pedro Reyes'}
                    ]
                },
                'grade8': {
                    'section-a': [
                        {value: 'student5', text: 'Carlos Mendoza'},
                        {value: 'student6', text: 'Lisa Rodriguez'}
                    ]
                }
            };

            // Clear current options
            studentSelect.innerHTML = '<option value="">Select Student</option>';

            // Add filtered students
            if (gradeLevel !== 'all' && section !== 'all') {
                const gradeStudents = students[gradeLevel]?.[section] || [];
                gradeStudents.forEach(student => {
                    const option = document.createElement('option');
                    option.value = student.value;
                    option.textContent = student.text;
                    studentSelect.appendChild(option);
                });
            } else {
                // Show all students if no specific filter
                Object.keys(attendanceData).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = attendanceData[key].name;
                    studentSelect.appendChild(option);
                });
            }
        }

        function exportReport(type) {
            const selectedStudent = document.getElementById('studentSelect').value;
            const studentName = selectedStudent ? attendanceData[selectedStudent]?.name : 'All Students';
            
            switch(type) {
                case 'individual':
                    if (!selectedStudent) {
                        alert('Please select a student first');
                        return;
                    }
                    generateIndividualReport(selectedStudent);
                    break;
                case 'class':
                    generateClassReport();
                    break;
                case 'predictions':
                    generatePredictionsReport();
                    break;
            }
        }

        function generateIndividualReport(studentId) {
            const student = attendanceData[studentId];
            const reportContent = `
                INDIVIDUAL STUDENT ATTENDANCE REPORT
                ===================================
                
                Student: ${student.name}
                Report Date: ${new Date().toLocaleDateString()}
                
                RISK ASSESSMENT:
                - Continuation Probability: ${student.continuationProb}%
                - Attendance Forecast (30 days): ${student.attendanceForecast}%
                - Risk Level: ${student.riskLevel}
                - Intervention Priority: ${student.interventionPriority}
                
                RECOMMENDATIONS:
                - Contact family immediately if absence pattern continues
                - Monitor transportation challenges
                - Schedule health check if needed
                - Consider academic support programs
                
                PREDICTION CONFIDENCE: 73%
                NEXT REVIEW DATE: ${new Date(Date.now() + 7*24*60*60*1000).toLocaleDateString()}
            `;
            
            downloadReport(reportContent, `${student.name}_Attendance_Report.txt`);
        }

        function generateClassReport() {
            const gradeLevel = document.getElementById('gradeLevel').value;
            const section = document.getElementById('section').value;
            
            const reportContent = `
                CLASS ATTENDANCE SUMMARY REPORT
                ==============================
                
                Grade Level: ${gradeLevel}
                Section: ${section}
                Report Date: ${new Date().toLocaleDateString()}
                
                CLASS STATISTICS:
                - Total Students: 25
                - Average Attendance Rate: 78%
                - High Risk Students: 3
                - Medium Risk Students: 8
                - Low Risk Students: 14
                
                TOP ABSENCE REASONS:
                1. Illness (35%)
                2. Family Issues (25%)
                3. Transportation (20%)
                4. Personal (15%)
                5. Other (5%)
                
                RECOMMENDATIONS:
                - Implement transportation assistance program
                - Strengthen health monitoring protocols
                - Increase family engagement initiatives
            `;
            
            downloadReport(reportContent, `Class_${gradeLevel}_${section}_Report.txt`);
        }

        function generatePredictionsReport() {
            const reportContent = `
                ATTENDANCE PREDICTIONS REPORT
                ============================
                
                Report Date: ${new Date().toLocaleDateString()}
                Forecast Period: Next 30 Days
                
                PREDICTION SUMMARY:
                - Overall Class Attendance Forecast: 79%
                - Expected Improvement: +2%
                - Confidence Level: 81%
                
                INDIVIDUAL PREDICTIONS:
                - Maria Santos: 82% (Medium Risk)
                - Juan Dela Cruz: 88% (Low Risk)
                - Ana Garcia: 55% (High Risk)
                - Pedro Reyes: 75% (Medium Risk)
                
                INTERVENTION RECOMMENDATIONS:
                - Immediate action required for Ana Garcia
                - Monitor Maria Santos and Pedro Reyes
                - Maintain current support for Juan Dela Cruz
                
                MODEL ACCURACY: 85%
                NEXT MODEL UPDATE: ${new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString()}
            `;
            
            downloadReport(reportContent, `Predictions_Report.txt`);
        }

        function downloadReport(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
            
            // Show success message
            showNotification(`Report "${filename}" downloaded successfully!`, 'success');
        }

        function printDashboard() {
            window.print();
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#28a745' : '#dc3545'};
                color: white;
                border-radius: 8px;
                z-index: 1000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Add CSS animation for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Real-time updates simulation
        setInterval(() => {
            const selectedStudent = document.getElementById('studentSelect').value;
            if (selectedStudent) {
                // Simulate real-time data updates
                const currentProb = parseInt(document.getElementById('continuationProb').textContent);
                const variation = Math.random() * 4 - 2; // ±2% variation
                const newProb = Math.max(0, Math.min(100, currentProb + variation));
                document.getElementById('continuationProb').textContent = Math.round(newProb) + '%';
                
                // Update forecast
                const currentForecast = parseInt(document.getElementById('attendanceForecast').textContent);
                const forecastVariation = Math.random() * 3 - 1.5; // ±1.5% variation
                const newForecast = Math.max(0, Math.min(100, currentForecast + forecastVariation));
                document.getElementById('attendanceForecast').textContent = Math.round(newForecast) + '%';
            }
        }, 30000); // Update every 30 seconds

        // Initialize with first student selected
        document.getElementById('studentSelect').value = 'student1';
        updateStudentData();
    </script>
</body>
</html>